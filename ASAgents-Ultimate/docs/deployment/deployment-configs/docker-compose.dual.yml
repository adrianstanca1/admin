version : '3.9'

#Dual Backend(Node.js AI + Java Enterprise) + Nginx + optional one - shot frontend build
          services : node -
                     backend : build : context :./ backend
                                                       dockerfile : Dockerfile.simple
                                                                        environment : NODE_ENV : production
                                                                                                     PORT : 4000 JWT_SECRET : ${JWT_SECRET : -your - super - secret - jwt - key - change - in - production} ports : -"4000:4000" healthcheck : test : [ "CMD", "curl", "-f", "http://localhost:4000/api/health" ] interval : 30s timeout : 10s retries : 3 networks : -dual -
                     net
                         restart : unless -
                                   stopped

                                       java -
                                   backend : build : context :./ backend / java dockerfile : Dockerfile environment : SERVER_PORT : 4001 JAVA_OPTS : -Xms256m - Xmx512m APP_SECURITY_JWT_SECRET : ${JWT_SECRET : -your - super - secret - jwt - key - change - in - production} APP_SECURITY_JWT_EXPECTED_ISSUER : asagents - api APP_SECURITY_JWT_EXPECTED_AUDIENCE : asagents - client ports : -"4001:4001" healthcheck : test : [ "CMD", "curl", "-f", "http://localhost:4001/api/enhanced/health" ] interval : 30s timeout : 10s retries : 5 depends_on : -node - backend networks : -dual - net restart : unless - stopped

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                nginx : image : nginx : alpine ports : -"80:80" volumes : -./
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            nginx / nginx.dual.conf : / etc / nginx / nginx.conf : ro -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ./ dist : / usr / share / nginx / html : ro depends_on : -node - backend - java - backend networks : -dual - net restart : unless - stopped healthcheck : test : [ "CMD", "curl", "-f", "http://localhost/health" ] interval : 30s timeout : 10s retries : 3

#Optional one - shot frontend build container(outputs to./ dist)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             frontend -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             build : build : context :.dockerfile : Dockerfile.frontend.production
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        environment : VITE_API_BASE_URL : /
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          api
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              volumes : -./
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          dist : / app / dist networks : -dual -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             net
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 command : [ "sh", "-c", "npm run build" ]

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           networks : dual -
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      net : driver : bridge
